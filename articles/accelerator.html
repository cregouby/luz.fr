<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="fr">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>API des accélérateurs • luz.fr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="API des accélérateurs">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Passer au contenu</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Navigation sur le site"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">luz.fr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Activer la navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Utiliser luz</h6></li>
    <li><a class="dropdown-item" href="../articles/get-started.html">Bien démarrer</a></li>
    <li><a class="dropdown-item" href="../articles/custom-loop.html">Boucles personnalisées</a></li>
    <li><a class="dropdown-item" href="../articles/accelerator.html">l'API des périphériques d'accélération</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Guides</h6></li>
    <li><a class="dropdown-item" href="../articles/lr-finder.html">Recherche du taux d'apprentissage avec lr_finder</a></li>
    <li><a class="dropdown-item" href="../articles/checkpoints.html">Instantannés de modèles</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../articles/examples/index.html">Examples</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Référence</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changements</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mlverse/luz/"><span class="fa fab fa-github fa-lg"></span> Contribuer</a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>API des accélérateurs</h1>
            
      
      <small class="dont-index">Source : <a href="https://github.com/cregouby/luz.fr/blob/HEAD/vignettes/accelerator.Rmd" class="external-link"><code>vignettes/accelerator.Rmd</code></a></small>
      <div class="d-none name"><code>accelerator.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlverse.github.io/luz/" class="external-link">luz</a></span><span class="op">)</span></span></code></pre></div>
<p>L’API des accélérateurs est une version simplifiée de la <a href="https://github.com/huggingface/accelerate" class="external-link">bibliothèque
Accelerate</a> de Hugging Face. Elle permet aux utilisateurs d’éviter le
code de gestion nécessaire pour écrire les boucles d’apprentissage qui
fonctionnent correctement sur plusieurs périphériques de calcul (les
CPUs et les GPUs). Actuellement, elle ne gère que l’utilisation des CPUs
et d’un unique GPU.</p>
<p>Cette API est conçue pour être la méthode la plus flexible possible
de l’utilisation du package luz. Avec l’API des accélérateurs, vous
écrivez le code torch d’apprentissage brut et, après quelques
modifications, vous gérez automatiquement son deploiement sur les
périphériques de calcul du modèle, des optimiseurs et des chargeurs de
donnée, donc vous n’avez pas besoin d’ajouter partout des
<code>$to(device="cuda")</code> dans votre code ou penser à l’ordre dans
lequel créer le modèle et les optimiseurs.</p>
<div class="section level2">
<h2 id="exemple">Exemple<a class="anchor" aria-label="anchor" href="#exemple"></a>
</h2>
<p>L’API des accélérateurs est mieux expliquée sur un exemple de
différence <code>diff</code> du code dans une boucle d’apprentissage
torch brut.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode diff"><code class="sourceCode diff"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>library(torch)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="va">+ library(luz)</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="va">+ acc &lt;- accelerator()</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="st">- device &lt;- "cpu"</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>data &lt;- tensor_dataset(</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>  x = torch_randn(100, 10),</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>  y = torch_rand(100, 1)</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>)</span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>dl &lt;- dataloader(data, batch_size = 10)</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>model &lt;- nn_linear(10, 1)</span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="st">- model$to(device = device)</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a>opt &lt;- optim_adam(model$parameters)</span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a><span class="va">+ c(model, opt, dl) %&lt;-% acc$prepare(model, opt, dl)</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a>model$train()</span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a>coro::loop(for (batch in dl) {</span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a>  opt$zero_grad()</span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a><span class="st">-  preds &lt;- model(batch$x$to(device = device))</span></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a><span class="va">+  preds &lt;- model(batch$x)</span></span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a><span class="st">-  loss &lt;- nnf_mse_loss(preds, batch$y$to(device = device))</span></span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a><span class="va">+  loss &lt;- nnf_mse_loss(preds, batch$y)</span></span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a>  loss$backward()</span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a>  opt$step()</span>
<span id="cb2-32"><a href="#cb2-32" tabindex="-1"></a>})</span></code></pre></div>
<p>Avec les modifications de code montrées, vous n’avez plus besoin de
déplacer manuellement les données et les paramètres entre périphériques,
ce qui rend votre code plus facile à lire et moins sujet aux
erreurs.</p>
<p>Vous pouvez trouver des informations supplémentaires en utilisant
<code><a href="../reference/accelerator.html">help(accelerator)</a></code>.</p>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Développé par Christophe Regouby.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site créé avec <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
